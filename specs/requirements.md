# 变量系统 - Requirements Document

实现类似虚幻5蓝图的变量功能，支持创建变量、查看修改变量默认值、拖拽变量到场景创建Get/Set节点

## Core Features

变量系统将为工作流引擎提供动态数据存储和管理功能，支持在工作流运行期间存储、读取和修改数据值。系统包含变量创建、管理、使用三大核心功能模块。

### 变量管理功能
- 支持创建、编辑、删除变量
- 支持多种数据类型：int、float、str、bool
- 支持为每个变量设置默认值
- 支持变量重命名和类型修改

### 变量使用功能
- 支持拖拽变量到画布创建Get节点（获取变量值）
- 支持拖拽变量到画布创建Set节点（设置变量值）
- 支持在运行时动态修改变量值
- 支持变量值在工作流执行期间持久化

### 用户界面功能
- 左侧变量列表面板，显示所有可用变量
- 右侧属性面板，显示和编辑选中变量的属性
- 变量创建对话框，支持设置变量名称、类型、默认值
- 变量拖拽交互，支持创建Get/Set节点

## User Stories

- As a 工作流设计师, I want 在左侧菜单创建变量, so that 我可以存储和管理工作流中的数据
- As a 工作流设计师, I want 在右侧查看和修改变量的默认值, so that 我可以配置变量的初始状态
- As a 工作流设计师, I want 拖拽变量到场景中选择创建Get或Set节点, so that 我可以方便地在工作流中使用变量
- As a 工作流设计师, I want 在运行时修改变量值, so that 我可以根据条件动态改变工作流行为
- As a 工作流设计师, I want 变量值在工作流执行期间保持, so that 后续节点可以使用前面节点设置的值
- As a 工作流设计师, I want 重命名变量时自动更新所有引用该变量的节点, so that 我可以维护变量的一致性
- As a 工作流设计师, I want 删除变量时检查引用情况, so that 我可以避免破坏现有的工作流逻辑

## Acceptance Criteria

### 变量管理功能
- [ ] 支持创建新变量，设置名称、类型、默认值
- [ ] 支持删除变量，删除前检查是否有节点引用
- [ ] 支持重命名变量，重命名后自动更新所有引用节点
- [ ] 支持修改变量类型，修改时检查类型兼容性
- [ ] 支持修改变量默认值，修改后立即生效
- [ ] 变量名称唯一性检查，不允许重复名称
- [ ] 变量名称格式验证，只允许字母、数字、下划线

### 变量使用功能
- [ ] 支持拖拽变量到画布创建Get节点
- [ ] 支持拖拽变量到画布创建Set节点
- [ ] Get节点输出变量当前值
- [ ] Set节点将输入值设置到变量
- [ ] 变量值在工作流执行期间正确传递
- [ ] 支持变量值在节点间正确流动

### 用户界面功能
- [ ] 左侧变量列表面板显示所有变量
- [ ] 变量列表支持展开/折叠
- [ ] 右键菜单支持创建、编辑、删除变量
- [ ] 右侧属性面板显示选中变量详细信息
- [ ] 变量创建对话框包含名称、类型、默认值设置
- [ ] 拖拽变量时弹出菜单选择Get/Set节点类型
- [ ] 变量列表支持搜索和筛选

### 数据持久化功能
- [ ] 变量数据随工作流一起保存到JSON文件
- [ ] 加载工作流时恢复变量数据和节点关联
- [ ] 支持变量默认值和当前值的序列化
- [ ] 支持变量与节点的关联关系序列化

### 执行引擎功能
- [ ] 执行开始时初始化所有变量为默认值
- [ ] Set节点正确修改变量值
- [ ] Get节点正确获取变量当前值
- [ ] 变量值修改后立即对后续节点生效
- [ ] 支持变量值的类型检查和转换

## Non-functional Requirements

### 性能要求
- 变量操作响应时间 < 100ms
- 支持最多100个变量同时存在
- 变量值传递延迟 < 10ms
- 工作流加载时间不因变量数量显著增加

### 兼容性要求
- 与现有节点系统完全兼容
- 支持所有现有数据类型(int, float, str, bool)
- 与现有工作流文件格式向后兼容
- 不影响现有工作流的执行性能

### 用户体验要求
- 拖拽操作直观流畅，提供视觉反馈
- 变量命名冲突时提供清晰的错误提示
- 变量删除时提供确认对话框
- 支持撤销/重做变量操作
- 提供变量使用统计和引用检查

### 代码质量要求
- 遵循现有代码架构和设计模式
- 变量系统模块化设计，便于扩展
- 提供完整的单元测试覆盖
- 代码注释清晰，文档完整
- 错误处理和异常处理完善

### 安全性要求
- 变量名称不允许包含特殊字符，防止注入攻击
- 变量值类型严格检查，防止类型错误
- 工作流文件加载时验证变量数据完整性
- 敏感数据(如密码)不应存储在变量中(文档说明)
